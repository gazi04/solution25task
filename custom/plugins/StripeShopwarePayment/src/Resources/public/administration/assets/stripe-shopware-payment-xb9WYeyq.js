const v=`{% block stripe_payment %} <sw-page> <template #smart-bar-header> <h2> {{ $t('sw-settings.index.title') }} <mt-icon v-if="shopwareVersion.startsWith('6.7')" small name="regular-chevron-right-xs" /> <sw-icon v-else small name="regular-chevron-right-xs" /> {{ $t('stripe-shopware-payment-config-page.smart-bar.title') }} </h2> </template> <template #smart-bar-actions> <mt-button v-if="shopwareVersion.startsWith('6.7')" :routerLink="{ name: 'sw.settings.index' }"> {{ $t('stripe-shopware-payment-config-page.smart-bar.cancel') }} </mt-button> <sw-button v-else :routerLink="{ name: 'sw.settings.index' }"> {{ $t('stripe-shopware-payment-config-page.smart-bar.cancel') }} </sw-button> {% block stripe_shopware_payment__payment_config_page__save_settings_button %} <sw-button-process variant="primary" :isLoading="isLoading" :disabled="isLoading" :processSuccess="isSaveSuccessful" @click="saveConfig" > {{ $t('stripe-shopware-payment-config-page.smart-bar.save') }} </sw-button-process> {% endblock %} </template> <template #content> {% block stripe_shopware_payment__payment_config_page__main_content %} <sw-card-view> {% block stripe_shopware_payment__payment_config_page__above_system_config_card %} {% endblock %} <sw-system-config ref="systemConfig" salesChannelSwitchable :domain="configDomain" @config-changed="updateConfig" /> {% block stripe_shopware_payment__payment_config_page__below_system_config_card %} {% endblock %} </sw-card-view> {% endblock %} </template> </sw-page> {% endblock %}`,{Component:C,Mixin:b}=Shopware,{object:j,types:F}=Shopware.Utils,_="created",$="updated",P="no_changes",h="StripeShopwarePayment.sales-channel-plugin-config";C.register("stripe-plugin-settings",{template:v,mixins:[b.getByName("notification")],inject:["stripeShopwarePaymentWebhookRegistrationService","stripeShopwarePaymentConfigApiService"],data(){return{isLoading:!1,isSaveSuccessful:!1,config:null,configDomain:h,publishableKeyValid:!1,secretKeyValid:!1,shopwareVersion:Shopware.Context.app.config.version}},computed:{globalConfig(){return this.$refs.systemConfig.actualConfigData.null||{}}},metaInfo(){return{title:this.$createTitle(this.$t("stripe-shopware-payment-config-page.title"))}},methods:{async saveConfig(){this.isLoading=!0;try{await this.$refs.systemConfig.saveAll(),this.isSaveSuccessful=!0,this.createNotificationSuccess({title:this.$t("stripe-shopware-payment-config-page.controller.titles.success"),message:this.$t("stripe-shopware-payment-config-page.controller.messages.save.success")})}catch(t){this.isSaveSuccessful=!1;let e=t.response&&t.response.data;e||(e=this.$t("stripe-shopware-payment-config-page.controller.messages.unknown-error")),this.createNotificationError({title:this.$t("stripe-shopware-payment-config-page.controller.titles.error"),message:this.$t("stripe-shopware-payment-config-page.controller.messages.save.error",{errorMessage:e})}),this.isLoading=!1;return}if(await this.validateCredentials(),this.secretKeyValid&&this.getConfigValue(this.config,"stripeSecretKey"))try{await Promise.all([this.registerWebhook(),this.updateStripeAccountCountry()])}finally{delete this.$refs.systemConfig.actualConfigData[this.$refs.systemConfig.currentSalesChannelId],await this.$refs.systemConfig.readAll()}this.isLoading=!1},updateConfig(t){this.config=t,this.isSaveSuccessful=!1},async validateCredentials(){const t=this.getConfigValueWithInheritance("stripePublicKey"),e=this.getConfigValueWithInheritance("stripeSecretKey"),s=[];s.push(this.stripeShopwarePaymentConfigApiService.validateSecretKey(e)),t?s.push(this.stripeShopwarePaymentConfigApiService.validatePublishableKey(t)):s.push(!0);try{[this.secretKeyValid,this.publishableKeyValid]=await Promise.all(s)}catch(r){this.createNotificationError({title:this.$t("stripe-shopware-payment-config-page.controller.titles.error"),message:this.$t("stripe-shopware-payment-config-page.controller.messages.credentials.error",{errorMessage:r.message})});return}this.showCredentialsNotification()},async registerWebhook(){try{const t=this.$refs.systemConfig.currentSalesChannelId;switch((await this.stripeShopwarePaymentWebhookRegistrationService.registerWebhook(t)).result){case _:this.createNotificationSuccess({title:this.$t("stripe-shopware-payment-config-page.controller.titles.success"),message:this.$t("stripe-shopware-payment-config-page.controller.messages.webhook.created")});break;case $:this.createNotificationSuccess({title:this.$t("stripe-shopware-payment-config-page.controller.titles.success"),message:this.$t("stripe-shopware-payment-config-page.controller.messages.webhook.updated")});break;case P:break;default:this.createNotificationError({title:this.$t("stripe-shopware-payment-config-page.controller.titles.error"),message:this.$t("stripe-shopware-payment-config-page.controller.messages.webhook.error",{errorMessage:this.$t("stripe-shopware-payment-config-page.controller.messages.unknown-error")})});return}}catch(t){let e=t.response.data.result;e||(e=this.$t("stripe-shopware-payment-config-page.controller.messages.unknown-error")),this.createNotificationError({title:this.$t("stripe-shopware-payment-config-page.controller.titles.error"),message:this.$t("stripe-shopware-payment-config-page.controller.messages.webhook.error",{errorMessage:e})})}},showCredentialsNotification(){if(this.secretKeyValid&&this.publishableKeyValid)this.createNotificationSuccess({title:this.$t("stripe-shopware-payment-config-page.controller.titles.success"),message:this.$t("stripe-shopware-payment-config-page.controller.messages.credentials.valid")});else{const t=[];this.secretKeyValid||t.push(this.$t("stripe-shopware-payment-config-page.controller.messages.credentials.stripeSecretKey")),this.publishableKeyValid||t.push(this.$t("stripe-shopware-payment-config-page.controller.messages.credentials.stripePublishableKey")),this.createNotificationError({title:this.$t("stripe-shopware-payment-config-page.controller.titles.error"),message:this.$t("stripe-shopware-payment-config-page.controller.messages.credentials.invalid",{invalidFields:t.join(", ")})})}},getConfigValue(t,e){return t[`${h}.${e}`]},getConfigValueWithInheritance(t){return this.getConfigValue(this.config,t)||this.getConfigValue(this.globalConfig,t)},async updateStripeAccountCountry(){const t=this.$refs.systemConfig.currentSalesChannelId;try{await this.stripeShopwarePaymentConfigApiService.updateStripeAccountCountry({salesChannelId:t})}catch(e){const s=e.response.data.errors[0].detail;this.createNotificationError({title:this.$t("stripe-shopware-payment-config-page.controller.titles.error"),message:this.$t("stripe-shopware-payment-config-page.controller.messages.update-account-country.error",{errorMessage:s})})}}}});const k='{% block stripe_settings_icon %} <svg width="24" height="24" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg" > <defs> <linearGradient id="linearGradient" x1="100%" y1="58.356%" x2="0%" y2="0%" > <stop stop-color="#2697D4" offset="0%" /> <stop stop-color="#207BCB" offset="50%" /> <stop stop-color="#2285CE" offset="100%" /> </linearGradient> </defs> <path d="M24,0 L232,0 C245.254834,-2.4348735e-15 256,10.745166 256,24 L256,232 C256,245.254834 245.254834,256 232,256 L24,256 C10.745166,256 1.623249e-15,245.254834 0,232 L0,24 C-1.623249e-15,10.745166 10.745166,2.4348735e-15 24,0 Z" style="fill:url(#linearGradient); fill-rule:nonzero;" /> <path d="M139.688,111 C126.761,106.22 119.677,102.5 119.677,96.657 C119.677,91.697 123.75,88.865 131.011,88.865 C144.292,88.865 157.927,94.001 167.313,98.604 L172.625,65.844 C165.187,62.302 149.958,56.459 128.885,56.459 C114.011,56.459 101.615,60.354 92.761,67.615 C83.551,75.229 78.771,86.209 78.771,99.49 C78.771,123.573 93.469,133.844 117.375,142.521 C132.781,148.011 137.917,151.907 137.917,157.927 C137.917,163.771 132.957,167.135 123.927,167.135 C112.77,167.135 94.355,161.646 82.312,154.563 L77,187.677 C87.27,193.521 106.395,199.541 126.23,199.541 C141.99,199.541 155.094,195.823 163.948,188.74 C173.864,180.948 179,169.438 179,154.563 C179,129.948 163.948,119.677 139.687,111.001 L139.688,111 Z" style="fill:#FFFFFF; fill-rule:evenodd;" /> </svg> {% endblock %}';var p,g;function E(){var t;return g||(g=1,p=(t=window.Shopware)==null?void 0:t.Vue),p}var c=E();const A={xmlns:"http://www.w3.org/2000/svg",width:"256",height:"256"};function d(t,e){return c.openBlock(),c.createElementBlock("svg",A,e[0]||(e[0]=[c.createStaticVNode('<defs><linearGradient id="a" x1="100%" x2="0%" y1="58.356%" y2="0%"><stop offset="0%" stop-color="#2697D4"></stop><stop offset="50%" stop-color="#207BCB"></stop><stop offset="100%" stop-color="#2285CE"></stop></linearGradient></defs><path d="M24 0h208c13.255 0 24 10.745 24 24v208c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V24C0 10.745 10.745 0 24 0" style="fill:url(#a);fill-rule:nonzero;"></path><path d="M139.688 111c-12.927-4.78-20.011-8.5-20.011-14.343 0-4.96 4.073-7.792 11.334-7.792 13.281 0 26.916 5.136 36.302 9.739l5.312-32.76c-7.438-3.542-22.667-9.385-43.74-9.385-14.874 0-27.27 3.895-36.124 11.156-9.21 7.614-13.99 18.594-13.99 31.875 0 24.083 14.698 34.354 38.604 43.031 15.406 5.49 20.542 9.386 20.542 15.406 0 5.844-4.96 9.208-13.99 9.208-11.157 0-29.572-5.489-41.615-12.572L77 187.677c10.27 5.844 29.395 11.864 49.23 11.864 15.76 0 28.864-3.718 37.718-10.801 9.916-7.792 15.052-19.302 15.052-34.177 0-24.615-15.052-34.886-39.313-43.562z" style="fill:#fff;fill-rule:evenodd;"></path>',3)]))}const x={render:d},f=Object.freeze(Object.defineProperty({__proto__:null,default:x,render:d},Symbol.toStringTag,{value:"Module"})),{Component:m}=Shopware;m.register("stripe-settings-icon",{template:k,data(){return{svgData:f}},computed:{assetFilter(){return Shopware.Filter.getByName("asset")}}});m.override("sw-icon",{watch:{name:{async handler(t){if(t.indexOf("stripe-shopware-payment-icon")===0)switch(await this.$nextTick(),t){case"stripe-shopware-payment-icon-plugin":this.iconSvgData=f;break;default:this.iconSvgData=""}},immediate:!0}}});const{Module:V}=Shopware;V.register("stripe-settings",{name:"stripe-settings",type:"plugin",color:"#9AA8B5",title:"stripe-shopware-payment-config-module",iconComponent:"stripe-settings-icon",routeMiddleware(t,e){t(e)},routes:{view:{component:"stripe-plugin-settings",path:"view",meta:{parentPath:"sw.settings.index"}}},settingsItem:{group:"plugins",to:"stripe.settings.view",backgroundEnabled:!1,iconComponent:"stripe-settings-icon",label:"stripe-shopware-payment-config-module.stripe-shopware-payment"},snippets:{"de-DE":{"stripe-shopware-payment-config-module":{"stripe-shopware-payment":"Stripe"}},"en-GB":{"stripe-shopware-payment-config-module":{"stripe-shopware-payment":"Stripe"}}}});var w="https://js.stripe.com/v3",L=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var I=function(){for(var e=document.querySelectorAll('script[src^="'.concat(w,'"]')),s=0;s<e.length;s++){var r=e[s];if(L.test(r.src))return r}return null},N=function(e){var s="",r=document.createElement("script");r.src="".concat(w).concat(s);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(r),r},B=function(e,s){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"1.54.2",startTime:s})},a=null,K=function(e){return a!==null||(a=new Promise(function(s,r){if(typeof window>"u"||typeof document>"u"){s(null);return}if(window.Stripe){s(window.Stripe);return}try{var i=I();i&&e||i||(i=N(e)),i.addEventListener("load",function(){window.Stripe?s(window.Stripe):r(new Error("Stripe.js not available"))}),i.addEventListener("error",function(){r(new Error("Failed to load Stripe.js"))})}catch(o){r(o);return}})),a},W=function(e,s,r){if(e===null)return null;var i=e.apply(void 0,s);return B(i,r),i},y=Promise.resolve().then(function(){return K(null)}),S=!1;y.catch(function(t){S||console.warn(t)});var D=function(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];S=!0;var i=Date.now();return y.then(function(o){return W(o,s,i)})};const l=Shopware.Classes.ApiService,R="stripe-payment";class T extends l{constructor(e,s){super(e,s,R)}async validateSecretKey(e){const s=this.getBasicHeaders(),r=await this.httpClient.post(`_action/${this.getApiBasePath()}/validate-secret-key`,{stripeSecretKey:e},{headers:s});return l.handleResponse(r)}async validatePublishableKey(e){const s=await D(e);try{return!!(await s.createToken("pii",{personal_id_number:"test"})).token}catch{return!1}}async updateStripeAccountCountry({salesChannelId:e}){const s=this.getBasicHeaders(),r=await this.httpClient.post(`_action/${this.getApiBasePath()}/update-stripe-account-country`,{salesChannelId:e},{headers:s});return l.handleResponse(r)}}const u=Shopware.Classes.ApiService,M="stripe-payment";class O extends u{constructor(e,s){super(e,s,M)}async registerWebhook(e){const s=this.getBasicHeaders(),r=await this.httpClient.put(`_action/${this.getApiBasePath()}/register-webhook`,{salesChannelId:e},{headers:s});return u.handleResponse(r)}}const{Application:n}=Shopware;n.addServiceProvider("stripeShopwarePaymentWebhookRegistrationService",t=>{const e=n.getContainer("init");return new O(e.httpClient,t.loginService)});n.addServiceProvider("stripeShopwarePaymentConfigApiService",t=>{const e=n.getContainer("init");return new T(e.httpClient,t.loginService)});
//# sourceMappingURL=stripe-shopware-payment-xb9WYeyq.js.map
