<sw-card title="Product Bundle Configuration" :isLoading="isLoading">
    
    <template v-if="bundle">
        
        <sw-text-field
            label="Bundle Title"
            v-model="bundle.title"
            placeholder="Enter a title for this bundle...">
        </sw-text-field>

        <sw-divider></sw-divider>

        <sw-container columns="repeat(2, 1fr)" gap="0 30px">
            <sw-entity-single-select
                label="Select Product"
                v-model:value="newProductId"
                entity="product"
                :criteria="productCriteria"
                labelProperty="name"
                valueProperty="id"
                placeholder="Search and select a product...">
            </sw-entity-single-select>

            <sw-number-field
                label="Quantity"
                v-model="newQuantity"
                :min="1"
                :step="1">
            </sw-number-field>
        </sw-container>

        <sw-button
            variant="primary"
            @click="addProduct"
            :disabled="!newProductId || isLoading || !bundle"
            style="margin-top: 10px;">
            Add Product to Bundle
        </sw-button>

        <sw-divider style="margin: 20px 0;"></sw-divider>

        <br><br>

        <h3>Assigned Products</h3>

        <template v-if="assignedProducts && assignedProducts.length > 0">
            <sw-data-grid
                :dataSource="assignedProducts"
                :columns="assignedProductsColumns"
                :showSelection="false"
                :showActions="true"
                @inline-edit-save="onInlineEditSave"
                @inline-edit-cancel="onInlineEditCancel">

                <template #column-product="{ item }">
                    <span v-if="item.product && item.product.name">
                        {{ item.product.name }}
                    </span>
                    <span v-else-if="item.product && item.product.translated">
                        {{ item.product.translated.name }}
                    </span>
                    <span v-else class="text-muted">
                        (Product ID: {{ item.productId | truncate(8) }})
                    </span>
                </template>

                <template #column-quantity="{ item, isInlineEdit }">
                    <sw-number-field
                        v-if="isInlineEdit"
                        v-model="item.quantity"
                        size="small"
                        :min="1">
                    </sw-number-field>
                    <span v-else>
                        {{ item.quantity }}
                    </span>
                </template>

                <template #actions="{ item }">
                    <sw-context-menu-item variant="danger" @click="removeProduct(item)">
                        Delete
                    </sw-context-menu-item>
                </template>

            </sw-data-grid>
        </template>

        <sw-empty-state
            v-else
            title="No products assigned yet"
            subline="Use the form above to add products to this bundle.">
        </sw-empty-state>

        <sw-divider style="margin: 20px 0;"></sw-divider>
        <br>

        <sw-button
            variant="primary"
            @click="saveAll"
            :disabled="isLoading || !product || !product.id">
            Save Bundle
        </sw-button>

    </template>

    <sw-loader v-else-if="isLoading"></sw-loader>

    <sw-empty-state
        v-else
        title="Initializing bundle..."
        subline="Please wait...">
    </sw-empty-state>

</sw-card>
